<!DOCTYPE html>
<html lang="en">
<head>
        <title>Avoiding accumulated error while using GPolyLine (Google Maps API)</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css" />
        <link rel="stylesheet" href="./theme/css/main.css" />
</head>
<body>

    <div class="navigation pure-menu pure-menu-horizontal">
        <a href="./" class="pure-menu-heading  pure-menu-link">Slacy's Blog</a>
        <ul class="pure-menu-list">
            <li class="pure-menu-item"></li>

        </ul>
    </div>


<div class="page-container">
    <div class="entry-content">
        <div class="post-meta pure-g">
<div class="pure-u-3-4 meta-data">
    <a href="./category/geocaching-web.html" class="category">Geocaching, Web</a><br />

    <a class="author" href="./author/slacy.html">slacy</a>
    &mdash; <abbr title="2007-01-13T23:06:00-08:00">Sat 13 January 2007</abbr>
</div>        </div>
    </div>

    <div class="article-header-container">
        <div class="background-image-container">

            <div class="background-image-small">
                <div class="title-container">
                    <h1>Avoiding accumulated error while using GPolyLine (Google Maps <span class="caps">API</span>)</h1>
                </div>
            </div>
        </div>
    </div>

    <div class="entry-content">
        <p>If you&#8217;re using the GPolyLine() <span class="caps">API</span> to Google Maps, and you&#8217;re using the
string encoding to store a large number of points, you have to be very
careful not to incur accumulated error as you encode the&nbsp;points.</p>
<p>The problem comes from the fact that the GPolyLine function fromEncoded
uses a special encoding that only encodes 5 digits of precision beyond
the decimal point. So, if you&#8217;re not careful, those left over bits after
the 5th digit (if your source data has them) can add up to a nasty
amount of error over time. A line with only a hundred or so points won&#8217;t
show much error, but when you get to thousands, it ads up pretty
quickly. You&#8217;ll see this problem manifest itself as a line whose
starting position is perfect, but at the end of the line, it will be
shifted several hundred feet in some&nbsp;direction.</p>
<p>This comes from the fact that the Polyline encoding uses 5 digit
precision <em>delta</em> values to encode the difference between the previous
point and the next. Full positions are only encoded at the beginning of
each&nbsp;segment.</p>
<p>A naive algogithm, like the one below, will reproduce the&nbsp;error:</p>
<p><code>Encode( RoundToFiveDigits( point[0] ) ); for i = 1..points: Encode( RoundToFiveDigits( point[i] - point[i-1] ) );</code></p>
<p>And, if you change the code as follows, you won&#8217;t get the accumulated&nbsp;error:</p>
<p><code>Encode( RoundToFiveDigits( point[0] ); for i = 1 .. points: Encode( RoundToFiveDigits( point[i] ) - RoundToFiveDigits(point[i-1]) );</code></p>
<p>It&#8217;s subtle, but it makes a <em>huge</em> difference when you&#8217;re encoding
several thousand points. When I first thought that this might be the
problem, my thought was that if there was rounding error, that on
average, it should work out that the errors should all add up to zero,
with equal amounts of positive and negative error in each direction. The
flaw in this logic is that 5 digits is probably just on the edge of what
my <span class="caps">GPS</span> unit can distinguish, and thus, the 6th digit probably has a
higher likelihood of being one value versus another, so the start to&nbsp;accumulate.</p>
    </div>

    <footer>
        <div class="pure-g post-footer">
            <div class="pure-u-1 pure-u-md-1-2">
                <div class="pure-g poster-info">
                    <div class="pure-u">
                        <a href="./author/slacy.html"><img src="https://slacy.github.io/blog/images/ygg.png" alt=""></a>
                    </div>
                    <div class="pure-u-3-4">
                        <h3 class="author-name"><a href="./author/slacy.html">slacy</a></h3>
                        <p class="author-description">
                                              
                        </p>
                    </div>
                </div>
            </div>



        </div>


    </footer>


</div>



    <footer class="index-footer">

        <a href="./" title="Slacy's Blog">Slacy's Blog</a>

    </footer>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-85612-4', 'auto');
      ga('send', 'pageview');

    </script>
</body>
</html>