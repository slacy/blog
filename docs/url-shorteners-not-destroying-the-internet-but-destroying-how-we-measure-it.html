<!DOCTYPE html>
<html lang="en">
<head>
        <title>URL Shorteners: Not destroying the internet, but destroying how we measure it.</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css" />
        <link rel="stylesheet" href="./theme/css/main.css" />
</head>
<body>

    <div class="navigation pure-menu pure-menu-horizontal">
        <a href="./" class="pure-menu-heading  pure-menu-link">Slacy's Blog</a>
        <ul class="pure-menu-list">
            <li class="pure-menu-item"></li>

        </ul>
    </div>


<div class="page-container">
    <div class="entry-content">
        <div class="post-meta pure-g">
<div class="pure-u-3-4 meta-data">
    <a href="./category/general.html" class="category">General</a><br />

    <a class="author" href="./author/slacy.html">slacy</a>
    &mdash; <abbr title="2010-04-15T12:06:00-07:00">Thu 15 April 2010</abbr>
</div>        </div>
    </div>

    <div class="article-header-container">
        <div class="background-image-container">

            <div class="background-image-small">
                <div class="title-container">
                    <h1><span class="caps">URL</span> Shorteners: Not destroying the internet, but destroying how we measure&nbsp;it.</h1>
                </div>
            </div>
        </div>
    </div>

    <div class="entry-content">
        <p>For some work on <a href="http://parentsguild.com/">Parents Guild</a>we&#8217;ve been
doing experiments with links from <span class="caps">URL</span> shorteners.  As you may know, <span class="caps">URL</span>
shorteners are the norm for services like Twitter, FriendFeed, and&nbsp;FaceBook.</p>
<h2>Here&#8217;s the&nbsp;problem:</h2>
<p>When someone shortens a link to our site, this effectively destroys the
<span class="caps">HTTP</span> Referrer&nbsp;information.</p>
<p>What does that mean?  That means you lose all track of where the click
came from, and you can&#8217;t tell who&#8217;s clicking on what.  Traffic from <span class="caps">URL</span>
shorteners like bit.ly, fb.me, ow.ly, etc. all look <em>exactly</em> the same
as if the user has typed your <span class="caps">URL</span> in their location bar.  This is
unacceptable.  There is no way to use <strong>any</strong> analytics software to say
&#8220;Show me incoming links from the following tweet&#8221; or &#8220;show me incoming
links from bit.ly&#8221;.   To help mitigate this problem, most <span class="caps">URL</span> shorteners
have implemented their own analytics solutions, but with literally
dozens of shorteners out there, this is an untenable solution for
website maintainers.  I want all my analytics on Google Analytics, or by
some means of parsing my own log files, thank you very&nbsp;much.</p>
<p><strong>What&#8217;s actually going on&nbsp;here?</strong></p>
<p>Here&#8217;s how things are supposed to work without <span class="caps">URL</span>&nbsp;shorteners:</p>
<p>A page on htttp://example.com/page.html contains a link that looks like
this: &lt;a href=&#8221;http://destination.com/target.html&#8221;&gt;a
link&lt;/a&gt;.  When the user clicks on &#8220;a link&#8221;, their browser sends a
request to destination.com with &#8220;<span class="caps">GET</span> /target.html&#8221; and some other header
information.  One critical piece of information is the Referer: <span class="caps">HTTP</span>
header, which for this case would be &#8220;http://expample.com/page.html&#8221;. 
This indicates to the web server at destination.com that the link is
from example.com, and this fact can be logged and tracked.  Analytics
programs, like Google Analytics, or any analytics that are based on log
parsing, can see this Referrer field, and figure out who&#8217;s linking to
your site, and what the URLs of those links&nbsp;are.</p>
<p>But, when links are shortened, http://example.com/page.html contains a
link like &lt;a href=&#8221;http://bit.ly/AbCxYz&#8221;&gt;a link&lt;/a&gt;.  When
the user clicks on &#8220;a link&#8221;, their browser connects to bit.ly, and it
issues &#8220;<span class="caps">GET</span> /AbCxYz&#8221;.  It sends the referrer of
&#8220;http://example.com/page.html&#8221; to bit.ly, who then responds with &#8220;Oh,
yeah, the location is actually http://destination.com/target.html&#8221;. 
This redirect information doesn&#8217;t include the fact that the original
page was on example.com!  The browser takes Location and fetches the
page from destination.com.  But, one key thing has been left out!  <strong>The
browser doesn&#8217;t know what the referring page is anymore, so it leaves
this field&nbsp;blank!</strong></p>
<p>Even if bit.ly (or the other shorteners, for that matter) included some
information in their redirect response that included the original
referrer <span class="caps">URL</span>, it would be up to the browser to &#8220;do the right thing&#8221; and
send this referrer along to the&nbsp;client.</p>
<h2>Possible solution&nbsp;#1:</h2>
<p>Amend the <span class="caps">HTTP</span> spec to include a new status code for <span class="caps">URL</span> shorteners to
use.   Call this &#8220;<span class="caps">HTTP</span> 312 Transparent Redirect&#8221;.    It should behave
exactly as <span class="caps">HTTP</span> 302 does, except that the server response should take
the Referer string as passed from the client, and put it in the
response.  When the client sees a 312 response, it should take the
Location field and the Referer field, and make a request to the server
specified, and include a new header &#8220;Shortener&#8221; that has the <span class="caps">URL</span> of the
shortened link for this&nbsp;request.</p>
<p>Pros: Fairly clean, reasonable extension to the existing&nbsp;protocol.</p>
<p>Cons: Requires new <span class="caps">HTTP</span> version, as well as new browser versions to work
right.  Older browsers wouldn&#8217;t parse these headers.  Not sure how this
would work with JavaScript based analytics like Google&nbsp;Analytics.</p>
<h2>Possible solution&nbsp;#2:</h2>
<p>Add a field to robots.txt that says &#8220;shortened links should add these
<span class="caps">HTTP</span> <span class="caps">GET</span> parameters&#8221;  It would look something like&nbsp;this:</p>
<div class="highlight"><pre><span></span>Shortener: *
Allow: /
RefererArg: src
ShortenerId: shrt
</pre></div>


<p>Then, when bit.ly constructs shortened links to my site, it would make
something that looks like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="n">Location</span><span class="o">:</span> <span class="n">http</span><span class="o">://</span><span class="n">destination</span><span class="o">.</span><span class="na">com</span><span class="sr">/target.html?src=http://example.com/page.html&amp;shrt=http://bit.ly/</span><span class="n">AbCxYz</span>
</pre></div>


<p>(This would be properly <span class="caps">URL</span> encoded, of&nbsp;course)</p>
<p><span class="caps">URL</span> shorteners would then periodically crawl robots.txt of the sites
that they&#8217;re shortening, and append these query params when they pass
through shortened&nbsp;links.</p>
<p>The syntax outlined above also has the important behavior of disallowing
shorteners for a gives site, as we can similarly do for well-behaved
crawlers.  This means that a site can control the known shorteners that
are producing links to it&#8217;s&nbsp;sites!</p>
<p>Google Analytics could then also crawl the robots.txt file, understand
these shortener parameters, and display the proper referrer and
shortener&nbsp;information.</p>
<h2>What can we do about this&nbsp;now?</h2>
<p>As a web developer, there&#8217;s not a lot you can do.  One thing would be to
implement your own version of Solution #2.  If you know you&#8217;re going to
post a shortened link somewhere, you could construct a custom <span class="caps">URL</span> with
query parameters for your own tracking.  For exmalpe, one could
implement
http://destination.com/inbound/&lt;<span class="caps">ANYTHING</span>&gt;/actual/path.html that
would then issue <strong>another redirect</strong> to
http://destination.com/actual/path.html.  This solution sucks, because
the user has to pay the penalty of the extra redirect, which can be
upwards of 200ms in some&nbsp;cases.</p>
<p>Another possible solution is to implement something like
http://destination.com/target.html?shrt=bit.ly where you just log and
ignore the shrt= parameter, but it&#8217;s there for tracking purposes.  This
is also sloppy, but works as&nbsp;well.</p>
    </div>

    <footer>
        <div class="tags">
            <a href="./tag/http.html">http</a>
            <a href="./tag/location.html">location</a>
            <a href="./tag/redirect.html">redirect</a>
            <a href="./tag/url-shortener.html">url shortener</a>
        </div>
        <div class="pure-g post-footer">
            <div class="pure-u-1 pure-u-md-1-2">
                <div class="pure-g poster-info">
                    <div class="pure-u">
                        <a href="./author/slacy.html"><img src="https://slacy.github.io/blog/images/ygg.png" alt=""></a>
                    </div>
                    <div class="pure-u-3-4">
                        <h3 class="author-name"><a href="./author/slacy.html">slacy</a></h3>
                        <p class="author-description">
                                              
                        </p>
                    </div>
                </div>
            </div>



        </div>


    </footer>


</div>



    <footer class="index-footer">

        <a href="./" title="Slacy's Blog">Slacy's Blog</a>

    </footer>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-85612-4', 'auto');
      ga('send', 'pageview');

    </script>
</body>
</html>