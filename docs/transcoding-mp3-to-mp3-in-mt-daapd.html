<!DOCTYPE html>
<html lang="en">
<head>
        <title>transcoding mp3-to-mp3 in mt-daapd</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css" />
        <link rel="stylesheet" href="./theme/css/main.css" />
</head>
<body>

    <div class="navigation pure-menu pure-menu-horizontal">
        <a href="./" class="pure-menu-heading  pure-menu-link">Slacy's Blog</a>
        <ul class="pure-menu-list">
            <li class="pure-menu-item"></li>

        </ul>
    </div>


<div class="page-container">
    <div class="entry-content">
        <div class="post-meta pure-g">
<div class="pure-u-3-4 meta-data">
    <a href="./category/general.html" class="category">General</a><br />

    <a class="author" href="./author/slacy.html">slacy</a>
    &mdash; <abbr title="2009-08-24T12:44:00-07:00">Mon 24 August 2009</abbr>
</div>        </div>
    </div>

    <div class="article-header-container">
        <div class="background-image-container">

            <div class="background-image-small">
                <div class="title-container">
                    <h1>transcoding mp3-to-mp3 in&nbsp;mt-daapd</h1>
                </div>
            </div>
        </div>
    </div>

    <div class="entry-content">
        <h2>Introduction</h2>
<p>mt-daapd is an iTunes daap-protocol server for Unix systems.  I&#8217;m using
mt-daapd on by Ubuntu 9.04 system to stream music over the internet to
my workplace.   The issue is that many of my mp3 files are 256kbps mp3
files, and streaming these takes up more bandwidth than&nbsp;necessary.</p>
<p>mt-daapd includes a transcoding system called &#8220;ssc&#8221; for &#8220;Server Side
Conversion&#8221;.  This system works by either a shared-object plugin (i.e.
ssc_ffmpeg) or via an external script file (i.e.&nbsp;ssc_script).</p>
<p>using the ssc_script functionality, one can invoke &#8216;lame&#8217; (the mp3
encoder) to transcode high bitrate mp3 files into lower bitrate mp3
files.  The setup for this in mt-daapd wasn&#8217;t very obvious, so I&#8217;ll
document it&nbsp;here.</p>
<h2>Install&nbsp;mt-daapd</h2>
<p>The version of mt-daapd provided by Ubuntu 9.04 includes support for
transcoding, so you can just run:<br>
<code>$ sudo apt-get install mt-daapd</code></p>
<h2>Turn on&nbsp;ssc</h2>
<p>Edit your /etc/mt-daapd.conf file, and make sure you have the following
lines in the correct&nbsp;places:</p>
<blockquote>
<p>ssc_codectypes =&nbsp;mpeg</p>
<p>always_transcode =&nbsp;mpeg</p>
<p>ssc_prog =&nbsp;/path/to/script/shown/below/mt-daapd-mp3-ssc.sh</p>
<p>[plugins]</p>
<p>plugins =&nbsp;ssc-script.so</p>
</blockquote>
<h2>Create&nbsp;mt-daapd-mp3-ssc.sh</h2>
<p>You&#8217;ll need to create a shell script to do the transcoding via
ssc_scrpit / ssc_prog.  Here&#8217;s the script I&#8217;m&nbsp;using:</p>
<blockquote>
<p>#!/bin/bash</p>
<p><span class="caps">FILE</span>=\$1<br>
<span class="caps">OFFSET</span>=0</p>
<p>if [ &#8220;\<span class="math">\(2" == "" \]; then  
OFFSET=0  
else  
OFFSET=\\)</span>2<br>&nbsp;fi</p>
<p>if [ &#8220;\<span class="math">\(3" == "" \]; then  
FORGELEN=\\)</span>3<br>&nbsp;fi</p>
<p>lame -V6 &#8212;quiet &#8220;\$<span class="caps">FILE</span>&#8221;&nbsp;-</p>
</blockquote>
<p>Note that I&#8217;m looking at the 2nd and 3rd args, but I&#8217;m not doing
anything with them.  These arguments are used to make sure that seeking
works properly in your daap client.  I don&#8217;t care about seeking, and
doing it properly is somewhat hard, so I&#8217;ve just ignored those
arguments.  I think that this could be accomplished properly using the
program &#8216;mp3splt&#8217; but I haven&#8217;t looked into it enough to see what it
would&nbsp;take.</p>
<p>Make sure the script above is put somewhere accessible by the user
specified as &#8216;runas&#8217; in your mt-daapd.conf.   Make sure the script is
executable by this user as&nbsp;well.</p>
<h2>Restart mt-daapd and see if it&nbsp;works</h2>
<p>Restart mt-daapd&nbsp;via:</p>
<blockquote>
<p>\$ sudo /etc/init.d/mt-daapd&nbsp;restart</p>
</blockquote>
<p>Then reconnect your daap client (I use rhythmbox).  You can see if the
script is working by running &#8220;ps auwxww | grep lame&#8221; just after pressing
play on a song.  You should see your script executing lame and doing
realtime&nbsp;transcoding.</p>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    var location_protocol = (false) ? 'https' : document.location.protocol;
    if (location_protocol !== 'http' && location_protocol !== 'https') location_protocol = 'https:';
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = location_protocol + '//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>
    </div>

    <footer>
        <div class="tags">
            <a href="./tag/itunes.html">itunes</a>
            <a href="./tag/lame.html">lame</a>
            <a href="./tag/linux.html">linux</a>
            <a href="./tag/mp3.html">mp3</a>
            <a href="./tag/mt-daapd.html">mt-daapd</a>
            <a href="./tag/music.html">Music</a>
            <a href="./tag/transcoding.html">transcoding</a>
            <a href="./tag/unix.html">unix</a>
            <a href="./tag/vbr.html">vbr</a>
        </div>
        <div class="pure-g post-footer">
            <div class="pure-u-1 pure-u-md-1-2">
                <div class="pure-g poster-info">
                    <div class="pure-u">
                        <a href="./author/slacy.html"><img src="https://slacy.github.io/blog/images/ygg.png" alt=""></a>
                    </div>
                    <div class="pure-u-3-4">
                        <h3 class="author-name"><a href="./author/slacy.html">slacy</a></h3>
                        <p class="author-description">
                                              
                        </p>
                    </div>
                </div>
            </div>



        </div>


    </footer>


</div>



    <footer class="index-footer">

        <a href="./" title="Slacy's Blog">Slacy's Blog</a>

    </footer>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-85612-4', 'auto');
      ga('send', 'pageview');

    </script>
</body>
</html>