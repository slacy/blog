<!DOCTYPE html>
<html lang="en">
<head>
        <title>Making a copy of constructor arguments inÂ C++</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css" />
        <link rel="stylesheet" href="./theme/css/main.css" />
</head>
<body>

    <div class="navigation pure-menu pure-menu-horizontal">
        <a href="./" class="pure-menu-heading  pure-menu-link">Slacy's Blog</a>
        <ul class="pure-menu-list">
            <li class="pure-menu-item"></li>

        </ul>
    </div>


<div class="page-container">
    <div class="entry-content">
        <div class="post-meta pure-g">
<div class="pure-u-3-4 meta-data">
    <a href="./category/general.html" class="category">General</a><br />

    <a class="author" href="./author/slacy.html">slacy</a>
    &mdash; <abbr title="2010-05-20T13:12:00-07:00">Thu 20 May 2010</abbr>
</div>        </div>
    </div>

    <div class="article-header-container">
        <div class="background-image-container">

            <div class="background-image-small">
                <div class="title-container">
                    <h1>Making a copy of constructor arguments in&nbsp;C++</h1>
                </div>
            </div>
        </div>
    </div>

    <div class="entry-content">
        <p>Okay, maybe my C++ is getting rusty, but I&#8217;m stammering at coming up
with a reasonable solution to this&nbsp;problem:</p>
<p>Imagine a class, like this&nbsp;one:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Foo</span> <span class="p">{</span>
  <span class="kr">public</span><span class="o">:</span>
    <span class="nx">Foo</span><span class="p">(</span><span class="kt">string</span> <span class="o">&amp;</span><span class="nx">name</span><span class="p">)</span> <span class="o">:</span> <span class="nx">name_</span><span class="p">(</span><span class="nx">name</span><span class="p">.</span><span class="nx">c_str</span><span class="p">())</span> <span class="p">{</span> <span class="p">}</span>
  <span class="kr">private</span><span class="o">:</span>
    <span class="kr">char</span> <span class="o">*</span><span class="nx">name_</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>As you can see, it takes the guts of the string argument passed to the
constructor, and stores them internally. In other words, it assumes that
the caller is going to manage the lifetime of the string argument so
that it lives at least as long as the instance of Foo. Ignore that this
might be horribly bad style for a second, and pretend that this is an
external class that you want to interface with. What I want to be able
to do is&nbsp;this:</p>
<div class="highlight"><pre><span></span>Foo f = Foo(string(&quot;foo&quot;));
</pre></div>


<p>But, of course, that will totally crash. So, I&#8217;d like to write a wrapper
class, that looks like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">FooWrapper</span> : <span class="kt">public</span> <span class="nx">Foo</span> <span class="p">{</span>
  <span class="kr">public</span><span class="o">:</span>
    <span class="nx">FooWrapper</span><span class="p">(</span><span class="kt">string</span> <span class="o">&amp;</span><span class="nx">name</span><span class="p">)</span> <span class="o">:</span>
        <span class="nx">Foo</span><span class="p">(</span><span class="nx">make_a_copy</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">name_copy_</span><span class="p">))</span> <span class="p">{</span> <span class="p">}</span>

    <span class="kt">string</span> <span class="o">&amp;</span><span class="nx">make_a_copy</span><span class="p">(</span><span class="kt">string</span> <span class="o">&amp;</span><span class="nx">src</span><span class="p">,</span> <span class="kt">string</span> <span class="o">&amp;</span><span class="nx">dest</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">dest</span> <span class="o">=</span> <span class="nx">src</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">dest</span><span class="p">;</span>
    <span class="p">}</span>

  <span class="kr">private</span><span class="o">:</span>
    <span class="kt">string</span> <span class="nx">name_copy_</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>But here&#8217;s the problem: The code in make_a_copy() crashes because the
guts of the string representation stored in name_copy_ is total
garbage and not initialized to a reasonable state yet. I could create a
factory function and add some yucky methods to FooWrapper, but I&#8217;d
really rather not. Is there an easier way to accomplish this &#8220;copy on
construct&#8221;&nbsp;behavior?</p>
    </div>

    <footer>
        <div class="tags">
            <a href="./tag/c.html">c++</a>
            <a href="./tag/pointers.html">pointers</a>
            <a href="./tag/python-interface.html">python interface</a>
            <a href="./tag/refcounting.html">refcounting</a>
            <a href="./tag/string.html">string</a>
        </div>
        <div class="pure-g post-footer">
            <div class="pure-u-1 pure-u-md-1-2">
                <div class="pure-g poster-info">
                    <div class="pure-u">
                        <a href="./author/slacy.html"><img src="https://slacy.github.io/blog/images/ygg.png" alt=""></a>
                    </div>
                    <div class="pure-u-3-4">
                        <h3 class="author-name"><a href="./author/slacy.html">slacy</a></h3>
                        <p class="author-description">
                                              
                        </p>
                    </div>
                </div>
            </div>



        </div>


    </footer>


</div>



    <footer class="index-footer">

        <a href="./" title="Slacy's Blog">Slacy's Blog</a>

    </footer>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-85612-4', 'auto');
      ga('send', 'pageview');

    </script>
</body>
</html>